---
title: "Workshop 8 TEMPLATE"
subtitle: "12 pm"
author: "Sequoia Marx"
date: "02/27/2026"
format:
  html:
    toc: true # use this to display a table of contents
execute:
  message: false # use this to make sure messages don't show up
  warning: false # use this to make sure warnings don't show upl
---

[deployed html url](https://samarx27.github.io/workshop-08_winter-2026/code/workshop-code.html)

In this workshop, we will answer the question: How do specific leaf area, water treatment, and species influence plant mass?  

**Specific leaf area** is a continuous variable measured in cm^2^/g.  

**Water treatment** is a categorical variable (i.e. a *factor*) with 2 levels: drought stressed (DS) and well watered (WW).  

**Species** is a categorical variable (again, a *factor*) with 7 levels.  

| Species name                 | Species code | Common name        |
|------------------------------|--------------|--------------------|
| _Encelia californica_        | ENCCAL       | Bush sunflower     |  
| _Eschscholzia californica_   | ESCCAL       | California poppy   | 
| _Penstemon centranthifolius_ | PENCEN       | Scarlet bugler     | 
| _Grindelia camporums_        | GRINCAM      | Gumweed            | 
| _Salvia leucophylla_         | SALLEU       | Purple sage        | 
| _Stipa pulchra_              | STIPUL       | Purple needlegrass | 
| _Lotus scoparius_            | LOTSCO       | Deerweed           |

# 1. Set up

```{r}
#| label: packages and data

# read in your packages here
library(tidyverse) # general use
library(here) # file organization
library(janitor) # cleaning data frames
library(readxl) # reading excel files
library(scales) # modifying axis labels
library(ggeffects) # getting model predictions
library(MuMIn) # model selection

# read in your data here
drought_exp <- read_xlsx(
  here(
    "data", 
    "Valliere_etal_EcoApps_Data.xlsx"
  ),
  sheet = "First Harvest"
)


```

```{r}
#| label: plot colors and aesthetics

# storing colors to use for species
lotsco_col <- "#E69512"
pencen_col <- "#D6264F"
salleu_col <- "#6D397D"
enccal_col <- "#3A5565"
stipul_col <- "#3F564F"
esccal_col <- "#515481"
gricam_col <- "#6C91BD"

# storing colors to use for water treatments
ds_col <- "#A62F03"
ww_col <- "#045CB4"

# storing a ggplot theme (that will be used for all ggplots)
theme_set(theme_bw())
```


# 2. Clean data

Data source: Valliere, Justin; Zhang, Jacqueline; Sharifi, M.; Rundel, Philip (2019). Data from: Can we condition native plants to increase drought tolerance and improve restoration success? [Dataset]. Dryad. [https://doi.org/10.5061/dryad.v0861f7](https://doi.org/10.5061/dryad.v0861f7)

```{r}
#| label: data cleaning

# creating a new data frame
drought_exp_clean <- drought_exp |> 
  # cleaning the names- cleaned up names w underscored and lowercases
  clean_names() |> 
  # mutate adds in the actual words, changed the species code to the scientific name in a new column 
  mutate(species_name = case_match(
    species,
    "ENCCAL" ~ "Encelia californica", # bush sunflower
    "ESCCAL" ~ "Eschscholzia californica", # California poppy
    "PENCEN" ~ "Penstemon centranthifolius", # Scarlet bugler
    "GRICAM" ~ "Grindelia camporum", # Gumweed
    "SALLEU" ~ "Salvia leucophylla", # purple sage
    "STIPUL" ~ "Stipa pulchra", # purple needlegrass
    "LOTSCO" ~ "Lotus scoparius" # deerweed
  )) |> 
  # altering the names of water treatment create column with  
  mutate(water_treatment = case_match(
    water,
    "WW" ~ "Well watered",
    "DS" ~ "Drought stressed"
  ))  |> 
  # mutating the species names, makes variable into factor so it can be used in models 
  mutate(species_name = as_factor(species_name),
         species_name = fct_relevel(species_name,
                                    "Lotus scoparius",
                                    "Penstemon centranthifolius",
                                    "Salvia leucophylla",
                                    "Encelia californica",
                                    "Stipa pulchra",
                                    "Eschscholzia californica",
                                    "Grindelia camporum")) |> 
  mutate(water_treatment = as_factor(water_treatment),
         water_treatment = fct_relevel(water_treatment,
                                       "Drought stressed",
                                       "Well watered"))  |> 
  #selecting certain rows
  select(species_name, water_treatment, sla, total_g)
```

Insert code to double check the structure of the data frame here.  

```{r}
str(drought_exp_clean)
```



Insert code to display 10 random rows from the data frame here.  

```{r}
slice_sample(drought_exp_clean, 
             n = 10)
```




# 3. Visualizing data

## What is the relationship between SLA and plant mass?  

Make a scatterplot to visualize SLA (the predictor) on the x-axis, and total mass (the response) on the y-axis.  

Label the axes with units where appropriate.  

Add a title describing the relationship (e.g. as SLA increases, total mass ______). 


```{r}
ggplot(data = drought_exp_clean, 
       aes(x = sla, 
           y = total_g,
           color = species_name)) +
  geom_point() +
  labs(title = "As SLA increases, total mass increases", 
       x = "Specific Leaf Area cm\u00B2\ (g)", 
       y = "Total Mass (g)") +
  theme(legend.position = "none")
```



## What are the differences in total mass between water treatments?

Make a jitterplot to visualize the differences in plant mass between water treatments.  

Label the axes with units where appropriate.  

Add a title describing the differences in (mean or median) plant mass between water treatments.


```{r}
ggplot(data = drought_exp_clean, 
       aes(x = water_treatment, 
           y = total_g,
           color = water_treatment)) +
  geom_jitter(height = 0, 
              width = 0.3) +
  scale_color_manual(values = c(
    "Drought stressed" = ds_col, 
    "Well Watered" = ww_col
  )) +
  labs(title = "The means of total mass are higher for well watered treamtent ", 
       x = "water treamtent", 
       y = "Total Mass (g)") +
  theme(legend.position = "none",
        plot.title.position = "plot")
```

## What are the differences in total mass between species?

Make a jitterplot to visualize the differences in plant mass between species.  

Label the axes with units where appropriate.  

Add a title describing the differences in (mean or median) plant mass between species.  

Bonus: order the x-axis by decreasing mean plant mass _and_ wrap the long species names using the `label_wrap()` function from the `scales` package.


```{r}
ggplot(data = drought_exp_clean, 
       aes(x = reorder(species_name, - total_g), 
           y = total_g,
           color = species_name)) +
  geom_jitter(height = 0, 
              width = 0.3) +
  scale_color_manual(values = c(
    "Lotus scoparius" = lotsco_col, 
    "Penstemon centranthifolius"= pencen_col,
    "Salvia leucophylla" = salleu_col, 
    "Encelia californica" = enccal_col, 
    "Stipa pulchra"= stipul_col, 
    "Eschscholzia californica" = esccal_col,
    "Grindelia camporum" = gricam_col
  )) +
  scale_x_discrete(labels = label_wrap(10)) +
  labs(title = "Plant mass differs accross species", 
       x = "Species name", 
       y = "Total Mass (g)") +
  theme(legend.position = "none",
        plot.title.position = "plot")
```



# 4. Fitting models

8 models total:

| Model number | SLA | Water treatment | Species | Predictor list              |  
|--------------|:---:|:---------------:|:-------:|:---------------------------:|  
| 0            |     |                 |         | no predictors (null model)  |
| 1            |  X  |       X         |    X    | all predictors (full model) | 
| 2            |  X  |       X         |         | SLA and water treatment     |   
| 3            |  X  |                 |    X    | SLA and species             |    
| 4            |     |       X         |    X    | water treatment and species |    
| 5            |  X  |                 |         | SLA                         |    
| 6            |     |       X         |         | water treatment             |    
| 7            |     |                 |    X    | species                     |

## Model fitting

```{r}
#| label: model fitting

# model 0: null model

model0 <- lm(total_g ~ 1, 
             data = drought_exp_clean)

# model 1: all predictors

model1 <- lm(total_g ~ sla + water_treatment + species_name, 
             data = drought_exp_clean)

# model 2: SLA and water treatment

model2 <- lm(total_g ~ sla + species_name, 
             data = drought_exp_clean)

# model 3: SLA and species

model3 <- lm(total_g ~ sla + species_name, 
             data = drought_exp_clean)

# model 4: water treatment and species

model4 <- lm(total_g ~ water_treatment + species_name, 
             data = drought_exp_clean)

# model 5: SLA

model5 <- lm(total_g ~ sla, 
             data = drought_exp_clean)

# model 6: water treatment

model6 <- lm(total_g ~ water_treatment, #response ~ predictor + predictor
             data = drought_exp_clean)

# model 7: species
# 
model7 <- lm(total_g ~ species_name, 
             data = drought_exp_clean)

```

## Model selection

Insert code to use the `AICc()` function to calculate the AIC for each model.  

Arrange by decreasing AIC.


```{r}
#| label: AIC model selection
AICc(
  model0, 
  model1, 
  model2, 
  model3, 
  model4, 
  model5, 
  model6, 
  model7
) |> 
  arrange(AICc)
```
Arrange by decreasing AIC. 
best model is model4: the one that includes only water treatment and species 



## Model diagnostics

Insert code to look at the diagnostic plots for the best model.

```{r}
par(mfrow = c(2,2)) #display plots in 2x2 grid
plot(model4) #plot model4 diagnostics
```
diagnostic plots look good. 
residals(standing in for errors) loook nromally distributed based on qq plot. 
residuals look homoscedastic (have const variace) based on residuals vs fitted plot and scale loc plot.
no outliers influencing model est of coefficients


## Summary

Insert code to display the summary for the best model. 
```{r}
summary(model4)

```

**What are the reference levels?**  

drought treatment and lotus scoparius because they are not listed in the summary output. 

**What does the `(Intercept)` represent?**  
est mass for drought stressed lotus scoparius 0.055 g plus minus 0.02


**What does `water_treatmentWell watered` represent?**

this is the model prediction for the diff in lotus scoparius mass btwn well watered and drought stressed treatments. the model preducts the diff is 0.12 +/- 0.02 (SE) g

**What does `species_namePenstemon centranthifolius` represent?**  

this is the model prediction for the diff between penstemon centranthifolius mass in the well watered treatment and lotus scoparius mass in well watered treatment. the model predicts that this difference is 0.05  +/- 0.03 (SE) g

**What does `species_nameEschscholzia californica` represent?**


this is the model prediction for the diff between Eschscholzia californica mass in the well watered treatment and lotus scoparius mass in well watered treatment. the model predicts that this difference is 0.23  +/- 0.03 (SE) g


## Stop and think: what does this model mean?  

**What is the best model?**

the best model includes water treatment and species as predictors 

**How much variation in the response (total mass, in grams) does this model explain?**

this model explains 72% of the variation in plant mass. 

**How do we interpret the effects of the predictors on the response variable (again, total mass in grams)?**

water treatment and species influences plant mass

# 4. Model predictions

Insert code to generate model predictions for the best model.  

Rename the `x` column and `group` column to match the original data frame (`drought_exp_clean`).

Look at the object before plotting.



# 5. Final figure

Create a clean, publication ready figure depicting predictions for the best model and the underlying data.


# 6. Writing

## Figure caption








## Basic components of test

**predictors**  


**response**  


**test**  


**distribution**  


**parameters (degrees of freedom)**  


**test statistic**


**R^2^**  


**p-value**   


**significance level**  


**reference level(s)**  


## Written communication

### Methods

#### Goal of analysis


#### Model selection


#### Model diagnostics


### Results









